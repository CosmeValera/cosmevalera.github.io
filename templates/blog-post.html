{% extends "base.html" %}

{% import "related-container.html" as related %}

{% block title %}
  Blog | Cosme
{% endblock %}

{% block styles %}
  <link rel="stylesheet" href="{{ get_url(path="blog-post.css") | safe }}">
{% endblock %}

{% block scripts %}
  <script src="{{ get_url(path="js/exchange-toggle.js") | safe }}"></script>
  <script src="{{ get_url(path="js/blog-post-content-bar.js") | safe }}"></script>
{% endblock %}

{% block content %}
  <div class="blog-post">
    {% set post_date_numeric = page.date | date(format="%Y%m%d") | int %}
    {% set now_numeric = now() | date(format="%Y%m%d") | int %}
    
    {% if post_date_numeric > now_numeric %}
      {% set post_date_display = now() | date(format="%B %d, %Y") %}
    {% else %}
      {% set post_date_display = page.date | date(format="%B %d, %Y") %}
    {% endif %}

    <a href="/blog" class="back-link">← Back to all posts</a>
    
    {% if page.taxonomies and page.taxonomies.tags %}
      <div class="tags">
        {% for tag in page.taxonomies.tags %}
          {% if tag | slugify in config.extra.blog_post_tags %}
            <a href="{{ get_taxonomy_url(kind="tags", name=tag) }}" class="tag tag-{{ tag | slugify }}-plain">
              {{ tag | slugify | replace(from="-", to=" ") | title }}
            </a>
          {% else %}
            <a href="{{ get_taxonomy_url(kind="tags", name=tag) }}" class="tag tag-default-plain">
              {{ tag | slugify | replace(from="-", to=" ") | title }}
            </a>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}

    <h1 class="blog-post-title">{{ page.title }}</h1>
    <h3 class="presentation-text">{{ page.description }}</h3>
    
    <div class="post-metadata">
      <span class="post-date">{{ post_date_display }}</span>
      <span class="reading-time">
        {% if page.extra.custom_reading_time and page.extra.custom_word_count %}
          {{ page.extra.custom_reading_time }} min read • {{ page.extra.custom_word_count }} words
        {% else %}
          {{ page.reading_time | default(value="3") }} min read • {{ page.word_count | default(value="0") }} words
        {% endif %}
      </span>
    </div>
    <!-- Mobile TOC with progress bar -->
    <div class="toc-mobile" data-collapsed>
      <button class="toc-header" type="button" aria-expanded="false" aria-controls="toc-list">
        <span class="toc-title">Table of Contents</span>
        <span class="toc-chevron" aria-hidden="true"></span>
      </button>
      <ul id="toc-list" class="toc-list" role="list"></ul>
      <div class="reading-progress" aria-hidden="true"></div>
    </div>
    <div class="post-content">
        {{ page.content | safe }}
    </div>
  
    {% if page.slug == "bitcoin" %}
      <div class="readings-link">
        <h3>Related Reading</h3>
        <p>If you found this post interesting, you might want to check out my thoughts on:</p>
        <a href="/readings/filosofia-de-bitcoin/" class="reading-link">
          <i class="fas fa-book"></i>
          <span>Filosofía de Bitcoin</span>
          <small>by Álvaro D. María</small>
        </a>
      </div>
    {% endif %}
    
    <hr class="footer-rule" />
    {{ related::container(page=page,orderDesc=true) }}
    <hr class="footer-rule-2" />
    
  </div>
{% endblock content %}
