{% extends "base.html" %}

{% block title %}
  {{ term.name | slugify | replace(from="-", to=" ") | title }} ({{ taxonomy.name | title }}) | Cosme
{% endblock %}

{% block styles %}
  <link rel="stylesheet" href="{{ get_url(path="tags-single.css") | safe }}">
{% endblock %}

{% block scripts %}
  <script src="{{ get_url(path="js/tags-single.js") | safe }}"></script>
{% endblock %}

{% block content %}
  <div class="tag-single">
    {% if lang == "es" %}
      <a href="/es/{{ taxonomy.name }}" class="back-link">{{ trans(key="see_all_tags", lang=lang) }}</a>
    {% else %}
      <a href="/{{ taxonomy.name }}" class="back-link">{{ trans(key="see_all_tags", lang=lang) }}</a>
    {% endif %}
    <div class="tag-header">
      <h1 class="tags-single-title">{{ trans(key="posts_tagged", lang=lang) }}</h1>
      {% if term.name | slugify in config.extra.blog_post_tags %}
        <span class="current-tag tag-{{ term.name | slugify }}-plain" data-tag="{{ term.name | slugify }}">
          {{ trans(key=term.name|slugify|replace(from="-", to="_"), lang=lang) }}
        </span>
      {% else %}
        <span class="current-tag tag-default-plain" data-tag="{{ term.name | slugify }}">
          {{ term.name | slugify | replace(from="-", to=" ") | title }}
        </span>
      {% endif %}
    </div>
    <div class="blog-cards">
      {% for post in term.pages %}
        {% set post_date_numeric = post.date | date(format="%Y%m%d") | int %}
        {% set now_numeric = now() | date(format="%Y%m%d") | int %}

        {% if post_date_numeric > now_numeric %}
          {% set post_date_display = now() | date(format="%B %d, %Y") %}
        {% else %}
          {% set post_date_display = post.date | date(format="%B %d, %Y") %}
        {% endif %}

        {# Removed manual time_label logic in favor of trans #}

        <div class="blog-card{% if post.taxonomies and post.taxonomies.tags and post.taxonomies.tags | length > 0 and post.taxonomies.tags[0] | slugify in config.extra.blog_post_tags %} tag-{{ post.taxonomies.tags[0] | slugify }}{% endif %}" onclick="if(event.target.tagName !== 'A'){ window.location='{{ post.permalink }}'; }">
          {% if post.taxonomies and post.taxonomies.tags %}
            {% set tags_string = post.taxonomies.tags | join(sep=",") | lower %}

            {% if "recommended" in tags_string %}
              <a href="{{ get_taxonomy_url(kind='tags', name='recommended', lang=lang) }}" class="blog-card-icon blog-card-recommended" onclick="event.stopPropagation();">
                <i class="fas fa-star"></i>
                <span class="blog-card-tooltip">{{ trans(key="highly_recommended", lang=lang) }}</span>
              </a>
            {% elif "beginner" in tags_string %}
              <a href="{{ get_taxonomy_url(kind='tags', name='for-beginners', lang=lang) }}" class="blog-card-icon blog-card-for-beginners" onclick="event.stopPropagation();">
                <i class="fas fa-book"></i>
                <span class="blog-card-tooltip">{{ trans(key="great_for_beginners", lang=lang) }}</span>
              </a>
            {% endif %}

            <div class="blog-card-tags">
              {% for tag in post.taxonomies.tags %}
                {% set tag_lower = tag | lower %}
                {% if tag_lower != "recommended" and "beginner" not in tag_lower %}
                  {% if loop.index0 == 0 and tag | slugify in config.extra.blog_post_tags %}
                    <a href="{{ get_taxonomy_url(kind='tags', name=tag, lang=lang) }}" class="blog-card-tag tag-{{ tag | slugify }} tag-{{ tag | slugify }}" onclick="event.stopPropagation();">
                      {{ trans(key=tag|slugify|replace(from="-", to="_"), lang=lang) }}
                    </a>
                  {% else %}
                    <a href="{{ get_taxonomy_url(kind='tags', name=tag, lang=lang) }}" class="blog-card-tag tag-{{ tag | slugify }} tag-secondary" onclick="event.stopPropagation();">
                      {% if tag | slugify in config.extra.blog_post_tags %}
                        {{ trans(key=tag|slugify|replace(from="-", to="_"), lang=lang) }}
                      {% else %}
                        {{ tag | slugify | replace(from="-", to=" ") | title }}
                      {% endif %}
                    </a>
                  {% endif %}
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}

          <!-- TABLET LAYOUT WRAPPER -->
          <div class="blog-card-tablet-wrapper">
            <!-- LEFT SIDE: Content -->
            <div class="blog-card-tablet-content">
              <h3 class="blog-title">{{ post.title }}</h3>
              <div class="blog-card-details">
                <p class="card-description">{{ post.description }}</p>
                <div class="preview-indicator">
                  <i class="fas fa-eye"></i> {{ trans(key="hover_to_preview", lang=lang) }}
                </div>
                <div class="card-date-and-stats">
                  <span class="card-date">{{ post_date_display }}</span>
                  <span class="card-stats">
                    <i class="fas fa-clock"></i> 
                    {% if post.extra.custom_reading_time and post.extra.custom_word_count %}
                      {{ post.extra.custom_reading_time }}{{ trans(key="min_read", lang=lang) }} - <small>{{ post.extra.custom_word_count }} {{ trans(key="words", lang=lang) }}</small>
                    {% else %}
                      {{ post.reading_time }}{{ trans(key="min_read", lang=lang) }} - <small>{{ post.word_count }} {{ trans(key="words", lang=lang) }}</small>
                    {% endif %}
                  </span>
                </div>
              </div>
            </div>
            
            <!-- RIGHT SIDE: Tablet Preview -->
            <div class="blog-card-cover-preview-tablet {% if post.taxonomies and post.taxonomies.tags and post.taxonomies.tags | length > 0 and post.taxonomies.tags[0] | slugify in config.extra.blog_post_tags %} tag-{{ post.taxonomies.tags[0] | slugify }}{% endif %}">
              <img src="{{ post.extra.cover_image }}" alt="Cover preview for {{ post.title }}">
            </div>
          </div>

          <!-- MOBILE/DESKTOP LAYOUT (outside tablet wrapper) -->
          <h3 class="blog-title blog-title-mobile-desktop">{{ post.title }}</h3>
          <div class="blog-card-details blog-card-details-mobile-desktop">
            <p class="card-description">{{ post.description }}</p>
            <div class="preview-indicator">
              <i class="fas fa-eye"></i> {{ trans(key="hover_to_preview", lang=lang) }}
            </div>
            <div class="blog-card-cover-preview-down {% if post.taxonomies and post.taxonomies.tags and post.taxonomies.tags | length > 0 and post.taxonomies.tags[0] | slugify in config.extra.blog_post_tags %} tag-{{ post.taxonomies.tags[0] | slugify }}{% endif %}">
              <img src="{{ post.extra.cover_image }}" alt="Cover preview for {{ post.title }}">
            </div>
            <div class="card-date-and-stats">
              <span class="card-date">{{ post_date_display }}</span>
              <span class="card-stats">
                <i class="fas fa-clock"></i> 
                {% if post.extra.custom_reading_time and post.extra.custom_word_count %}
                  {{ post.extra.custom_reading_time }}{{ trans(key="min_read", lang=lang) }} - <small>{{ post.extra.custom_word_count }} {{ trans(key="words", lang=lang) }}</small>
                {% else %}
                  {{ post.reading_time }}{{ trans(key="min_read", lang=lang) }} - <small>{{ post.word_count }} {{ trans(key="words", lang=lang) }}</small>
                {% endif %}
              </span>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
{% endblock content %} 