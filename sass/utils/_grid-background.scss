// Fluid grid with 3 visual layers but low noise:
//  - ::before  -> static base grid
//  - ::after   -> drifting subtle grid (layer A)
//  - .grid-layer-3 -> drifting subtle grid (layer B, different params)
//  - .grid-ripple  -> soft travelling radial highlights (the "liquid" pulse)

.grid-background {
  position: fixed;
  inset: 0;
  z-index: -1;
  pointer-events: none;

  // tuning variables (easy to tweak)
  --g-a-size: 60px;
  --g-b-size: 72px;
  --g-a-opacity: 0.28;
  --g-b-opacity: 0.18;
  --g-a-blur: 0.35px;
  --g-b-blur: 0.9px;
  --ripple-opacity: 0.65;
  --ripple-blur: 22px;

  // --- static base grid (keeps things readable) ---
  &::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
      radial-gradient(circle 2px at 20px 20px, rgba(255, 255, 255, 0.05) 0%, transparent 50%),
      radial-gradient(circle 2px at 60px 60px, rgba(255, 255, 255, 0.03) 0%, transparent 50%);
    background-size: 40px 40px, 40px 40px, 80px 80px, 80px 80px;
    opacity: 1;
    pointer-events: none;
  }

  // --- drifting layer A (pseudo ::after) ---
  &::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(rgba(255, 255, 255, 0.10) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.10) 1px, transparent 1px);
    background-size: var(--g-a-size) var(--g-a-size);
    opacity: var(--g-a-opacity);
    filter: blur(var(--g-a-blur));
    mix-blend-mode: screen; /* brightens underlying grid where ripple passes */
    animation:
      driftA 22s linear infinite,
      pulseA 9s ease-in-out infinite;
    will-change: background-position, opacity, filter;
    pointer-events: none;
  }

  // --- drifting layer B (child element .grid-layer-3) ---
  .grid-layer-3 {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(rgba(255, 255, 255, 0.09) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.09) 1px, transparent 1px);
    background-size: var(--g-b-size) var(--g-b-size);
    opacity: var(--g-b-opacity);
    filter: blur(var(--g-b-blur));
    mix-blend-mode: screen;
    animation:
      driftB 30s linear infinite,
      pulseB 11s ease-in-out infinite;
    will-change: background-position, opacity, filter;
    pointer-events: none;
  }

  // --- soft travelling ripple overlay (two soft radial gradients via pseudo-element) ---
  .grid-ripple {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 0;

    /* main moving soft gradient (we animate background-position) */
    background:
      radial-gradient(circle, rgba(255,255,255,0.18) 0%, rgba(255,255,255,0.08) 22%, rgba(255,255,255,0.04) 40%, transparent 70%),
      radial-gradient(circle, rgba(255,255,255,0.12) 0%, rgba(255,255,255,0.06) 20%, transparent 55%);

    /* make them large so they blend gently across the page */
    background-repeat: no-repeat;
    background-size: 40vmax 40vmax, 28vmax 28vmax;
    /* initial positions; we will animate them */
    background-position: 5% 5%, 70% 15%;

    filter: blur(var(--ripple-blur));
    opacity: var(--ripple-opacity);
    mix-blend-mode: screen; /* screen tends to brighten on dark bg â€” adjust if needed */
    animation: rippleMove 20s cubic-bezier(.42,0,.58,1) infinite;
    will-change: background-position, opacity, filter;
  }

  // --- keyframes for drifting grids (smooth, multi-axis) ---
  @keyframes driftA {
    0%   { background-position: 0px 0px; }
    25%  { background-position: 14px -8px; }
    50%  { background-position: 28px 12px; }
    75%  { background-position: 12px -6px; }
    100% { background-position: 0px 0px; }
  }

  @keyframes driftB {
    0%   { background-position: 0px 0px; }
    20%  { background-position: -18px 14px; }
    45%  { background-position: -34px -11px; }
    70%  { background-position: -10px 6px; }
    100% { background-position: 0px 0px; }
  }

  // subtle breathing of visibility (very small range so it never disappears)
  @keyframes pulseA {
    0%, 100% { opacity: calc(var(--g-a-opacity)); }
    50%     { opacity: calc(var(--g-a-opacity) + 0.08); }
  }
  @keyframes pulseB {
    0%, 100% { opacity: calc(var(--g-b-opacity)); }
    50%     { opacity: calc(var(--g-b-opacity) + 0.06); }
  }

  // --- ripple path (moves both radial-gradients defined in background) ---
  @keyframes rippleMove {
    /* positions are percentage pairs for background-position of the two gradients */
    0%   { background-position: 5% 5%, 70% 15%; opacity: 0.62; }
    18%  { background-position: 18% 28%, 60% 25%; opacity: 0.78; }
    36%  { background-position: 38% 12%, 48% 38%; opacity: 0.68; }
    54%  { background-position: 60% 30%, 30% 60%; opacity: 0.82; }
    72%  { background-position: 78% 55%, 12% 78%; opacity: 0.60; }
    100% { background-position: 5% 5%, 70% 15%; opacity: 0.62; }
  }

  // Hide grid-ripple on blog post pages
  .blog-post-page & {
    .grid-ripple {
      display: none;
    }
  }

  // Accessibility: respect reduced motion
  @media (prefers-reduced-motion: reduce) {
    &::after,
    .grid-layer-3,
    .grid-ripple {
      animation: none !important;
      transition: none !important;
      filter: none !important;
      opacity: 0.35 !important;
    }
  }
}
